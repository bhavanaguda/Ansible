---
- name: CI/CD Pre-Checks
  hosts: localhost
  tasks:
    - block:
        - name: Check GitLab
          uri:
            url: https://github.com/bhavanaguda
            status_code: 200
          register: gitlab_response
 
        - name: Check Git
          shell: git --version
          register: git_response
 
        - name: Check Maven
          shell: mvn --version
          register: maven_response
 
        - name: Check SonarQube
          uri:
            url: http://10.138.77.106:9000
            status_code: 200
          register: sonarqube_response
 
        - name: Check Docker
          shell: docker --version
          register: docker_response
 
        - name: Check Docker Registry
          uri:
            url: https://hub.docker.com/u/bhavanaguda
            status_code: 200
          register: docker_registry_response
 
        - name: Check Kubernetes
          shell: kubectl cluster-info
          register: kubernetes_response
 
        - name: Display Results
          debug:
            msg: |
              GitLab: {{ gitlab_response.status }}
              Git: {{ 'installed' if 'git' in git_response.stdout else 'not installed' }}
              Maven: {{ 'installed' if 'mvn' in maven_response.stdout else 'not installed' }}
              SonarQube: {{ sonarqube_response.status }}
              Docker: {{ 'installed' if 'docker' in docker_response.stdout else 'not installed' }}
              Docker Registry: {{ docker_registry_response.status }}
              Kubernetes: {{ 'installed' if 'kubectl' in kubernetes_response.stderr else 'not installed' }}
      rescue:
        - debug:
            msg: "An error occurred during pre-checks. Please review the logs for more information."

